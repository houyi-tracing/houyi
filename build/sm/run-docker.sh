#!/bin/sh

ROOT_CMD='docker run -d -p 14250:14250 -p 14268:14268 -p 14269:14269 --name houyi-strategy-manager'

if [[ ${LOG_LEVEL} ]]; then
  ROOT_CMD="${ROOT_CMD} --env LOG_LEVEL=${LOG_LEVEL}"
fi

if [[ ${GRPC_LISTEN_PORT} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GRPC_LISTEN_PORT=${GRPC_LISTEN_PORT}"
fi

if [[ ${REFRESH_INTERVAL} ]]; then
  ROOT_CMD="${ROOT_CMD} --env REFRESH_INTERVAL=${REFRESH_INTERVAL}"
fi

if [[ ${SCALE_FACTOR} ]]; then
  ROOT_CMD="${ROOT_CMD} --env SCALE_FACTOR=${SCALE_FACTOR}"
fi

# Gossip
if [[ ${GOSSIP_SEED_GRPC_PORT} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_SEED_GRPC_PORT=${GOSSIP_SEED_GRPC_PORT}"
fi
if [[ ${GOSSIP_REGISTRY_ADDR} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_REGISTRY_ADDR=${GOSSIP_REGISTRY_ADDR}"
fi
if [[ ${GOSSIP_REGISTRY_GRPC_PORT} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_REGISTRY_GRPC_PORT=${GOSSIP_REGISTRY_GRPC_PORT}"
fi
if [[ ${GOSSIP_SEED_LRU_SIZE} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_SEED_LRU_SIZE=${GOSSIP_SEED_LRU_SIZE}"
fi

ROOT_CMD="${ROOT_CMD} houyitracing/strategy-manager"

echo $ROOT_CMD
eval $ROOT_CMD
