#!/bin/sh

ROOT_CMD='docker run -d -p 22590:22590 -p 22650:22650 -p 14580:14580 --name houyi-collector'

if [[ -z $CASSANDRA_SERVERS ]]; then
  echo "\$CASSANDRA_SERVERS must be set"
  exit -1
else
  ROOT_CMD="${ROOT_CMD} --env CASSANDRA_SERVERS=${CASSANDRA_SERVERS}"
fi
if [[ $LOG_LEVEL ]]; then
  ROOT_CMD="${ROOT_CMD} --env LOG_LEVEL=${LOG_LEVEL}"
fi
if [[ SST_MAX_CHILD_NODES ]]; then
  ROOT_CMD="${ROOT_CMD} --env SST_MAX_CHILD_NODES=${SST_MAX_CHILD_NODES}"
fi
if [[ COLLECTOR_GRPC_PORT ]]; then
  ROOT_CMD="${ROOT_CMD} --env COLLECTOR_GRPC_PORT=${COLLECTOR_GRPC_PORT}"
fi

# Gossip
if [[ ${GOSSIP_SEED_GRPC_PORT} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_SEED_GRPC_PORT=${GOSSIP_SEED_GRPC_PORT}"
fi
if [[ ${GOSSIP_REGISTRY_ADDR} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_REGISTRY_ADDR=${GOSSIP_REGISTRY_ADDR}"
fi
if [[ ${GOSSIP_REGISTRY_GRPC_PORT} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_REGISTRY_GRPC_PORT=${GOSSIP_REGISTRY_GRPC_PORT}"
fi
if [[ ${GOSSIP_SEED_LRU_SIZE} ]]; then
  ROOT_CMD="${ROOT_CMD} --env GOSSIP_SEED_LRU_SIZE=${GOSSIP_SEED_LRU_SIZE}"
fi

ROOT_CMD="${ROOT_CMD} houyitracing/collector"

echo $ROOT_CMD
eval $ROOT_CMD
